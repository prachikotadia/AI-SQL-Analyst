[build]
  command = "npm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "18"
  NPM_FLAGS = "--legacy-peer-deps"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[functions]
  included_files = ["public/**"]
  node_bundler = "esbuild"
  external_node_modules = ["formidable"]

[[functions]]
  name = "attachments"
  memory = 2048
  timeout = 30

[functions."api_attachments"]
  node_bundler = "esbuild"
  included_files = ["public/**"]

# Note: File storage in /uploads won't persist on Netlify (serverless)
# Consider using external storage (S3, etc.) for production
